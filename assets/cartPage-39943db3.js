import{_ as j,u as W,i as X,a as I,c as h,d as p,f as t,t as n,C as F,j as w,p as q,h as E,k as x,m as $,x as R,q as d,v as G,Q as H,F as S,g as A,R as nt,r as f,l as N,o as it,s as O,e as L,S as lt,E as ct,U as dt}from"./index-34d9ee9b.js";import{h as J}from"./moment-fbc5633a.js";import{_ as rt}from"./plus-b341551d.js";import{_ as _t}from"./minus-2d5bd9a5.js";import{S as C}from"./service-9db6be5c.js";import{t as K}from"./title-dot-31571a1f.js";const ut="/Aoido_web/assets/trash-27031829.svg";const M=c=>(q("data-v-f9248528"),c=c(),E(),c),gt={class:"cartPage_Item_content"},ht={class:"cartPage_Item_describe"},pt={class:"cartPage_Item_text"},mt=["onClick"],vt=M(()=>t("img",{class:"cartPage_Item_img",src:ut},null,-1)),ft=[vt],bt={class:"cartPage_Item_describe"},Ct={class:"cartPage_Item_text"},Pt=M(()=>t("a",null," $ ",-1)),yt={class:"cartPage_Item_store"},$t=["onClick"],kt=M(()=>t("img",{class:"cartPage_Item_img",src:rt},null,-1)),It=[kt],wt={class:"cartPage_Item_Data"},Dt=["onClick"],xt=M(()=>t("img",{class:"cartPage_Item_img",src:_t},null,-1)),Nt=[xt],Ot={__name:"cartPage_Item",props:{data:{},refresh:Function},setup(c){const r=c,o=W(),P=X(),u=I({count:r.data.count}),m=async()=>{let l=w.get("token"),g={id:r.data._id,token:l,count:1};(await C.postCreateCart(g)).status==="success"&&(u.count++,r.refresh())},b=async()=>{let l=w.get("token");if(u.count<=1)o.isAlertBoxComfirmChange(!0),o.AlertMessageChange("商品最少要大於一個。");else{let g={id:r.data._id,token:l,count:-1};(await C.postCreateCart(g)).status==="success"&&(u.count--,r.refresh())}},_=async()=>{let l={id:r.data._id,token:r.data.token};(await C.postDeleteCart(l)).status==="success"&&r.refresh()},i=()=>{P.push({name:"prodcutPage_Detail",params:{id:r.data._id},query:r.data})};return(l,g)=>(h(),p("div",{class:"cartPage_Item_contaner",onClick:g[0]||(g[0]=D=>i(c.data))},[t("div",gt,[t("div",ht,[t("div",pt,[t("a",null,n(c.data.describe),1)]),t("button",{onClick:F(_,["stop"])},ft,8,mt)]),t("div",bt,[t("div",Ct,[Pt,t("a",null,n(c.data.price),1)]),t("div",yt,[t("button",{onClick:F(m,["stop"])},It,8,$t),t("div",wt,[t("a",null,n(u.count),1)]),t("button",{onClick:F(b,["stop"])},Nt,8,Dt)])])])]))}},Vt=j(Ot,[["__scopeId","data-v-f9248528"]]);const Tt=c=>(q("data-v-6a0381e9"),c=c(),E(),c),Lt={class:"cartPage_subInfo_container"},St={class:"cartPage_subInfo_label"},At=["disabled"],Mt={class:"cartPage_subInfo_container"},Ut={class:"cartPage_subInfo_label"},Bt={class:"cartPage_subInfo_select"},Ft=["disabled"],Rt=["value"],jt=Tt(()=>t("a",null," / ",-1)),qt=["disabled"],Et=["value"],zt={class:"cartPage_subInfo_container"},Qt={class:"cartPage_subInfo_label"},Gt=["disabled"],Ht={class:"cartPage_subInfo_container"},Jt={class:"cartPage_subInfo_label"},Kt=["disabled"],Wt={__name:"cartPage_subInfo",setup(c){const r=x("selectedTownOption"),o=x("orderListData"),P=x("selectedCityOption"),u=x("CityTownData"),m=x("isChecked");return(b,_)=>(h(),p("div",null,[t("div",Lt,[t("label",St,n(b.$t("名字"))+":",1),$(t("input",{class:"cartPage_subInfo_input","onUpdate:modelValue":_[0]||(_[0]=i=>d(o).uesrName=i),placeholder:"uesrName",disabled:d(m)},null,8,At),[[R,d(o).uesrName]])]),t("div",Mt,[t("label",Ut,n(b.$t("縣市/鄉鎮"))+":",1),t("div",Bt,[$(t("select",{style:{height:"2rem",margin:"0px 7.5px"},"onUpdate:modelValue":_[1]||(_[1]=i=>H(P)?P.value=i:null),disabled:d(m)},[(h(!0),p(S,null,A(d(u).City,(i,l)=>(h(),p("option",{key:l,value:i},n(i),9,Rt))),128))],8,Ft),[[G,d(P)]]),jt,$(t("select",{style:{height:"2rem",margin:"0px 7.5px"},"onUpdate:modelValue":_[2]||(_[2]=i=>H(r)?r.value=i:null),disabled:d(m)},[(h(!0),p(S,null,A(d(u).Town,(i,l)=>(h(),p("option",{key:l,value:i},n(i),9,Et))),128))],8,qt),[[G,d(r)]])])]),t("div",zt,[t("label",Qt,n(b.$t("地址"))+":",1),$(t("input",{class:"cartPage_subInfo_input","onUpdate:modelValue":_[3]||(_[3]=i=>d(o).addres=i),placeholder:"addres",disabled:d(m)},null,8,Gt),[[R,d(o).addres]])]),t("div",Ht,[t("label",Jt,n(b.$t("電話"))+":",1),$(t("input",{class:"cartPage_subInfo_input","onUpdate:modelValue":_[4]||(_[4]=i=>d(o).phone=i),placeholder:"phone",disabled:d(m)},null,8,Kt),[[R,d(o).phone]])])]))}},Xt=j(Wt,[["__scopeId","data-v-6a0381e9"]]);const Yt=c=>(q("data-v-e26cb126"),c=c(),E(),c),Zt={class:"cartPage"},te={class:"cartPage_container"},ee={class:"cartPage_subInfo"},ae={class:"cartPage_subInfo_content"},se={class:"cartPage_subInfo_checkbox"},oe={for:"checkbox"},ne={class:"cartPage_Item"},ie={class:"cartPage_Item_ul"},le={class:"cartPageCoupon"},ce={style:{margin:"10px 2px"}},de={style:{margin:"10px"}},re={class:"cartPageCoupon_container"},_e=["value"],ue={style:{"margin-left":"5px"}},ge={style:{color:"gray","font-size":"0.8rem","margin-left":"5px"}},he={key:1,style:{margin:"10px 2px"}},pe={style:{margin:"10px"}},me={class:"cartPage_total"},ve={class:"cartPage_total_group"},fe={class:"cartPage_total_titel"},be={class:"cartPage_total_titel"},Ce={class:"cartPage_total_group"},Pe={key:0,class:"cartPage_total_titel"},ye={class:"cartPage_total_titel"},$e={class:"cartPage_total_groud"},ke={class:"cartPage_total_titel"},Ie=Yt(()=>t("a",null," $ ",-1)),we={class:"cartPage_total_titel"},De={__name:"cartPage",setup(c){const r=X(),o=W(),{isAlertBoxComfirm:P}=nt(o),u=f("臺北市"),m=f("中正區"),b=f(1),_=f(""),i=f(""),l=f(""),g=f(!1),D=f(!1),Y=f(!1),z=f(w.get("id")),k=I({data:{}}),v=I({uesrName:"",city:"",town:"",addres:"",phone:""}),U=I({data:{}}),V=I({City:"",Town:""}),B=I({data:{}}),Q=async()=>{o.isloadingChange(!0);let s={token:w.get("token"),page:b.value,pagination:9999},e=await C.postCartData(s);e&&(k.data=e.data),o.isloadingChange(!1)},Z=async()=>{let a=k.data.map(e=>({id:e._id,count:e.count})),s=w.get("token");if(["",null,void 0].includes(v.uesrName)||["",null,void 0].includes(v.addres)||["",null,void 0].includes(v.phone))o.isAlertBoxComfirmChange(!0),o.AlertMessageChange("資料未齊全");else if(a.length==0)o.isAlertBoxComfirmChange(!0),o.AlertMessageChange("購物車沒東西");else{o.isloadingChange(!0);let e={id:z.value,token:s,CheckOutList:a,selectedOption:l.value.id?l.value.id:"",infoData:{uesrName:v.uesrName,addres:v.addres,city:u.value,town:m.value,phone:v.phone}};const y=await C.postCreateOrder(e);(y==null?void 0:y.status)==="success"&&(o.isAlertBoxComfirmChange(!0),o.AlertMessageChange("訂單成立"),D.value=!0),o.isloadingChange(!1)}},tt=async()=>{const a=await C.getCountyItems();if((a==null?void 0:a.status)==="success"&&(a!=null&&a.data)){U.data=a.data;const s=Object.keys(a.data);V.City=s.filter(e=>e!=="_id"),V.Town=U.data[u.value]}},et=async()=>{if(g.value){let s={token:w.get("token")};o.isloadingChange(!0);const e=await C.postUserinfo(s);(e==null?void 0:e.status)==="success"&&(e!=null&&e.data)&&(v.uesrName=e==null?void 0:e.data[0].uesrName,v.addres=e==null?void 0:e.data[0].addres,v.phone=e==null?void 0:e.data[0].phone,u.value=e==null?void 0:e.data[0].city,m.value=e==null?void 0:e.data[0].town),o.isloadingChange(!1)}},at=async()=>{let a={id:z.value};o.isloadingChange(!0);const s=await C.postFindPersonalCoupon(a);(s==null?void 0:s.status)==="success"&&(s!=null&&s.data)&&(B.data=s.data),o.isloadingChange(!1)},st=a=>a<0,ot=()=>{r.go(0)};return N(u,(a,s)=>{V.Town=U.data[u.value]}),N(k,(a,s)=>{let e=k.data.reduce(function(y,T,xe,Ne){return y+Number(T.count)*Number(T.price)},0);_.value=e||0,i.value=e||0}),N(g,(a,s)=>{a&&et(),Y.value=g.value}),N(l,(a,s)=>{_.value=st(Number(i.value)-Number(a.discount))?0:Number(i.value)-Number(a.discount)}),N(P,(a,s)=>{!a&&D.value&&ot()}),it(()=>{Q(),tt(),at()}),O("orderListData",v),O("selectedCityOption",u),O("selectedTownOption",m),O("CityTownData",V),O("isChecked",g),(a,s)=>(h(),p("div",Zt,[t("div",te,[t("div",ee,[L(K,{msg:"會員資料"}),t("div",ae,[t("div",se,[$(t("input",{type:"checkbox",id:"checkbox","onUpdate:modelValue":s[0]||(s[0]=e=>g.value=e)},null,512),[[lt,g.value]]),t("label",oe,n(a.$t("同會員資料")),1)]),L(Xt)])]),t("div",ne,[L(K,{msg:"購物車"}),t("ul",ie,[(h(!0),p(S,null,A(k.data,(e,y)=>(h(),p("li",{class:"cartPage_Item_li",key:e._id},[L(Vt,{data:e,refresh:()=>Q()},null,8,["data","refresh"])]))),128))])])]),t("div",le,[t("div",ce,[t("a",de,n(a.$t("優惠卷")),1)]),t("div",re,[Object.keys(B.data).length>0?(h(!0),p(S,{key:0},A(B.data,(e,y)=>(h(),p("div",{key:e.id,class:"cartPage_coupon_item"},[$(t("input",{type:"radio",value:e,"onUpdate:modelValue":s[1]||(s[1]=T=>l.value=T)},null,8,_e),[[dt,l.value]]),t("div",null,[t("a",null,n(e.describe),1),t("a",ue,"$ "+n(e.discount),1),t("a",ge,n(d(J)(e.startDate).format("L"))+" - "+n(d(J)(e.endDate).format("L")),1)])]))),128)):(h(),p("div",he,[t("a",pe,n(a.$t("沒有優惠卷")),1)]))])]),t("div",me,[t("div",null,[t("div",ve,[t("a",fe,n(a.$t("選的商品")),1),t("a",be,n(k.data.length),1)]),t("div",Ce,[l.value.describe?(h(),p("a",Pe,n(a.$t("使用優惠卷")),1)):ct("",!0),t("a",ye,n(l.value.describe?l.value.describe:a.$t("未使用優惠卷")),1)])]),t("div",$e,[t("div",null,[t("a",ke,n(a.$t("合計金額")),1),Ie,t("a",we,n(_.value),1)]),t("button",{class:"cartPage_total_button",onClick:s[2]||(s[2]=e=>Z())},n(a.$t("結帳")),1)])])]))}},Me=j(De,[["__scopeId","data-v-e26cb126"]]);export{Me as default};
